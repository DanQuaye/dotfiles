#!/bin/bash

# Guy John <http://rumblesan.com>
# guy@rumblesan.com
#
# Thanks to
# Ryan Tomayko <http://tomayko.com/about>
# Zach Holman <http://zachholman.com/about>
# Mathias Bynens <http://mathiasbynens.be/>
# probably others as well

# the basics
: ${HOME=~}
: ${LOGNAME=$(id -un)}
: ${UNAME=$(uname)}

# ----------------------------------------------------------------------
# ENVIRONMENT CONFIGURATION
# ----------------------------------------------------------------------

# ignore python bytecode
export FIGNORE=".pyc"

# history stuff
export HISTCONTROL=ignoredups:ignorespace
alias h=history

# ----------------------------------------------------------------------
# PATH
# ----------------------------------------------------------------------

export DOTFILES=$HOME/.dotfiles

PATH=/usr/local/bin:$DOTFILES/bin:$DOTFILES/notes.txt:$PATH

# put ~/bin on PATH if you have it
if [ -d "$HOME/bin" ]; then
    PATH="$HOME/bin:$PATH"
fi
export PATH

# ----------------------------------------------------------------------
# PROMPT
# ----------------------------------------------------------------------

if [ `hostname -s` = "Solaris" ]; then
    # Home laptop is blue
    PS1='[\u@\[\033[00;34m\]\h\[\033[00m\]:\W]\$ '
elif [ `hostname -s` = "horsehead" ]; then
    # VPS is red
    PS1='[\u@\[\033[00;31m\]\h\[\033[00m\]:\W]\$ '
else
    # Work mac is green
    PS1='[\u@\[\033[00;32m\]\h\[\033[00m\]:\W]\$ '
fi;
export PS1

# ----------------------------------------------------------------------
# WINDOW
# ----------------------------------------------------------------------

export PROMPT_COMMAND='echo -ne "\033]0;${USER}@${HOSTNAME}\007"'

# ----------------------------------------------------------------------
# PAGER / EDITOR
# ----------------------------------------------------------------------

# EDITOR
if [ -n "$(command -v vim)" ]; then
    EDITOR=vim
else
    EDITOR=vi
fi
export EDITOR

# PAGER
if [ -n "$(command -v less)" ]; then
    PAGER="less -FirSwX"
    MANPAGER="less -FiRswX"
else
    PAGER=more
    MANPAGER="$PAGER"
fi
export PAGER MANPAGER

# ----------------------------------------------------------------------
# DIRCOLORS
# ----------------------------------------------------------------------

# if the dircolors utility is available, set that up to
dircolors="$(type -P gdircolors dircolors | head -1)"
test -n "$dircolors" && {
    COLORS=/etc/DIR_COLORS
    test -e "/etc/DIR_COLORS.$TERM"   && COLORS="/etc/DIR_COLORS.$TERM"
    test -e "$HOME/.dircolors"        && COLORS="$HOME/.dircolors"
    test ! -e "$COLORS"               && COLORS=
    eval `$dircolors --sh $COLORS`
}
unset dircolors

# ----------------------------------------------------------------------
# COMPLETIONS
# ----------------------------------------------------------------------

set completions-ignore-case On

# Source all the files in dotfiles/completions
for c in ${DOTFILES}/completions/*
do
    source $c
done

# ----------------------------------------------------------------------
# RUBY
# ----------------------------------------------------------------------

# Setup rbenv if it's on this machine
if [ -n "$(command -v rbenv)" ]; then
    eval "$(rbenv init -)"
fi

# ----------------------------------------------------------------------
# ALIASES
# ----------------------------------------------------------------------

# This needs to be sourced before the OSX file

# Source the aliases file
source "$DOTFILES/aliases.sh"

# ----------------------------------------------------------------------
# OSX
# ----------------------------------------------------------------------

# If this is OSX then source the bash.osx file
if [ "$UNAME" = Darwin ]; then
    source "$DOTFILES/bashrc.osx"
fi

# ----------------------------------------------------------------------
# MISC
# ----------------------------------------------------------------------

# Used for machine specific settings
if [ -f "$HOME/.localrc" ]; then
    source "$HOME/.localrc"
fi

