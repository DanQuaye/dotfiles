: ${HOME=~}
: ${LOGNAME=$(id -un)}
: ${UNAME=$(uname)}
: ${DOTFILES=$HOME/.dotfiles}
: ${REPODIR=$HOME/src}
: ${SHELLCFG=$DOTFILES/shellcfg}

# ----------------------------------------------------------------------
# ONLY FOR INTERACTIVE SHELLS
# ----------------------------------------------------------------------

# Don't load bashrc if this isn't an interactive shell
if [ -z interactive ]; then
   return
fi

# ----------------------------------------------------------------------
# PATH
# ----------------------------------------------------------------------

PATH=$DOTFILES/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/opt/X11/bin:/usr/texbin

# put ~/.local/bin on PATH if you have it
if [ -d $HOME/.local/bin ]; then
    PATH="$HOME/.local/bin:$PATH"
fi

# Mostly useful for brew cask
[ -f /usr/libexec/path_helper ] && eval `/usr/libexec/path_helper -s`

export PATH

# ----------------------------------------------------------------------
# TERM
# ----------------------------------------------------------------------

# correctly set terminal
export TERM='xterm-256color'

# ----------------------------------------------------------------------
# ZSH SETTINGS
# ----------------------------------------------------------------------

source $SHELLCFG/rumblesan-theme.zsh

# Load and run compinit
autoload -U add-zsh-hook
autoload -U compinit
compinit -i

# ----------------------------------------------------------------------
# ENVIRONMENT CONFIGURATION
# ----------------------------------------------------------------------

# ignore OSX folder setting files
FIGNORE="DS_Store"

# history stuff
export HISTCONTROL=ignoredups:ignorespace
export HISTSIZE=5000
export HISTFILESIZE=10000

# use good dircolors
if [ -n "$(command -v dircolors)" ]; then
    eval `dircolors $SHELLCFG/dircolors.ansi-dark`
fi

# ----------------------------------------------------------------------
# GPG CONFIGURATION
# ----------------------------------------------------------------------

# Start gpg-agent, but only if the socket file doesn't exist
if [ ! -S ~/.gnupg/S.gpg-agent ]; then
    eval $( gpg-agent --daemon )
fi
# Set gpg tty
export GPG_TTY=$(tty)

# ----------------------------------------------------------------------
# PAGER / EDITOR
# ----------------------------------------------------------------------

# EDITOR
if [ -n "$(command -v nvim)" ]; then
    EDITOR="nvim"
else
    EDITOR="vi"
fi
export EDITOR

# PAGER
if [ -n "$(command -v less)" ]; then
    PAGER="less -FirSwX"
    MANPAGER="less -FiRswX"
else
    PAGER=more
    MANPAGER="$PAGER"
fi
export PAGER MANPAGER

# ----------------------------------------------------------------------
# INPUT
# ----------------------------------------------------------------------

# set vim bindings
bindkey -v

# ----------------------------------------------------------------------
# COMPLETIONS
# ----------------------------------------------------------------------

# this should fix the git/hub alias completion issue
if [ -n "$(command -v hub)" ]; then
    eval "$(hub alias -s)"
fi

# add custom completion scripts
fpath=($SHELLCFG/completions $fpath)

# compsys initialization
autoload -U compinit
compinit

# show completion menu when number of options is at least 2
zstyle ':completion:*' menu select=2

# ----------------------------------------------------------------------
# ALIASES
# ----------------------------------------------------------------------

source $SHELLCFG/aliases.sh

# ----------------------------------------------------------------------
# FUNCTIONS
# ----------------------------------------------------------------------

source $SHELLCFG/functions.sh

# ----------------------------------------------------------------------
# LANGUAGES
# ----------------------------------------------------------------------
# Specific config for any programming languages

for l in $SHELLCFG/languages/*; do
    source $l
done

# ----------------------------------------------------------------------
# MISC
# ----------------------------------------------------------------------
# Miscellaneous config

for l in $SHELLCFG/misc/*; do
    source $l
done

# ----------------------------------------------------------------------
# OSX
# ----------------------------------------------------------------------
# OSX specific stuff

if [[ "$OSTYPE" == "darwin"* ]]
then
    source $SHELLCFG/zshrc-osx.sh
fi

# ----------------------------------------------------------------------
# DIRENV
# ----------------------------------------------------------------------
# Activate direnv hook if direnv installed

if [ -n "$(command -v direnv)" ]; then
    eval "$(direnv hook zsh)"
fi

# ----------------------------------------------------------------------
# MISC
# ----------------------------------------------------------------------
# Used for machine specific settings

[ -f $HOME/.localrc ] && source $HOME/.localrc

