#!/bin/bash


die()
{
    echo "$*"
    exit 1
}

worksubmodules()
{
    echo -n "Set work email for submodules? (y/N) "
    read WORKSUBS
    if [ "$WORKSUBS" == "y" ]; then

        CHECKDIR="${@:(-1)}"
        if [ -d "$CHECKDIR" ]; then
            cd "$CHECKDIR"
        fi
        git submodule foreach git config user.email $WORKEMAIL
        git submodule foreach git config repo.environment "work"
    fi
}

CLONEARGS="--recursive"
WORKEMAIL=`git config --get work.email`

echo "Hey, it looks like you're cloning a git repo!"

echo -n "Is this a work repo? (y/N) "
read WORKREPO
if [ "$WORKREPO" == "y" ]; then
    echo "I'll set your work email"
    git clone $CLONEARGS -c user.email=$WORKEMAIL -c repo.environment=work "$@"
    worksubmodules
else
    git clone $CLONEARGS "$@"
fi

