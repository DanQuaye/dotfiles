#!/bin/bash

# Set the correct executable to use
# Prefer hub but fall back to normal git
GIT=`which hub`
if [ -z "$GIT" ]; then
    GIT=`which git`
fi


die()
{
    echo "$*"
    exit 1
}

worksubmodules()
{
    echo -n "Set work email for submodules? (y/N) "
    read WORKSUBS
    if [ "$WORKSUBS" == "y" ]; then

        CHECKDIR="${@:(-1)}"
        if [ -d "$CHECKDIR" ]; then
            cd "$CHECKDIR"
        fi
        "$GIT" submodule foreach "$GIT" config user.email $WORKEMAIL
        "$GIT" submodule foreach "$GIT" config repo.environment "work"
    fi
}

CLONEARGS="--recursive"
WORKEMAIL=`git config --get work.email`

echo "Hey, it looks like you're cloning a git repo!"

echo -n "Is this a work repo? (y/N) "
read WORKREPO
if [ "$WORKREPO" == "y" ]; then
    echo "I'll set your work email"
    "$GIT" clone $CLONEARGS -c user.email=$WORKEMAIL -c repo.environment=work "$@"
    worksubmodules "$*"
else
    "$GIT" clone $CLONEARGS "$@"
fi

